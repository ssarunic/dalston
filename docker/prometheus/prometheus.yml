# Prometheus configuration for Dalston monitoring
# Enable with: docker compose --profile monitoring up -d

global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Gateway metrics
  - job_name: 'dalston-gateway'
    static_configs:
      - targets: ['gateway:8000']
    metrics_path: /metrics

  # Orchestrator metrics
  - job_name: 'dalston-orchestrator'
    static_configs:
      - targets: ['orchestrator:8001']
    metrics_path: /metrics

  # Queue metrics exporter
  - job_name: 'dalston-queue-exporter'
    static_configs:
      - targets: ['metrics-exporter:9100']
    metrics_path: /metrics

  # Batch STT engine metrics (M20)
  # Engines expose /metrics on port 9100 via lightweight HTTP server
  - job_name: 'dalston-batch-stt'
    static_configs:
      - targets:
          - 'stt-batch-prepare:9100'
          - 'stt-batch-transcribe-whisper:9100'
          - 'stt-batch-transcribe-whisper-cpu:9100'
          - 'stt-batch-transcribe-parakeet:9100'
          - 'stt-batch-transcribe-parakeet-cpu:9100'
          - 'stt-batch-align-whisperx:9100'
          - 'stt-batch-align-whisperx-cpu:9100'
          - 'stt-batch-diarize-pyannote-v31:9100'
          - 'stt-batch-diarize-pyannote-v31-cpu:9100'
          - 'stt-batch-diarize-pyannote-v40:9100'
          - 'stt-batch-diarize-pyannote-v40-cpu:9100'
          - 'stt-batch-pii-detect-presidio:9100'
          - 'stt-batch-audio-redact-audio:9100'
          - 'stt-batch-merge:9100'
    metrics_path: /metrics

  # Realtime STT worker metrics (M20)
  # Workers expose /metrics on port 9100 via aiohttp HTTP server
  # Note: Scaled workers are discovered via docker-compose service names
  - job_name: 'dalston-rt-stt'
    static_configs:
      - targets:
          - 'stt-rt-transcribe-parakeet-cpu:9100'  # Default (local dev)
          - 'stt-rt-transcribe-parakeet:9100'      # GPU
          - 'stt-rt-transcribe-whisper-cpu:9100'   # Whisper CPU
          - 'stt-rt-transcribe-whisper:9100'       # Whisper GPU
    metrics_path: /metrics
