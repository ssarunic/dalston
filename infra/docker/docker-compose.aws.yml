# Docker Compose override for AWS deployment
# Usage: docker-compose -f docker-compose.yml -f infra/docker/docker-compose.aws.yml up -d

services:
  gateway:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}
      # No S3_ENDPOINT - SDK auto-detects on EC2
      # No credentials - uses IAM instance role
    # Bind to all interfaces for Tailscale access
    ports:
      - "8000:8000"

  orchestrator:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}

  postgres:
    volumes:
      - /data/postgres:/var/lib/postgresql/data

  engine-audio-prepare:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}

  engine-faster-whisper:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}
      - HF_HOME=/data/models
    volumes:
      - /data/models:/data/models

  engine-whisperx-align:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}
      - HF_HOME=/data/models
    volumes:
      - /data/models:/data/models

  engine-pyannote:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}
      - HF_HOME=/data/models
    volumes:
      - /data/models:/data/models

  engine-final-merger:
    environment:
      - S3_BUCKET=${S3_BUCKET}
      - AWS_REGION=${AWS_REGION}

# Exclude MinIO services - using S3 instead
# The base docker-compose.yml may define minio and minio-init
# but they won't be started unless explicitly included
