schema_version: "1.1"
id: pii-presidio
stage: pii_detect
name: PII Detection (GLiNER + Presidio checksum)
version: 2.0.0
description: |
  Detects personally identifiable information using GLiNER (zero-shot NER)
  as the primary detector, supplemented by Presidio for checksum-validated
  patterns (credit cards via Luhn, IBANs via mod-97).

container:
  gpu: optional  # GPU accelerates GLiNER
  memory: 4G
  model_cache: /models

capabilities:
  languages:
    - all  # GLiNER is multilingual, Presidio regex works on any language
  max_concurrency: 8

config_schema:
  type: object
  properties:
    entity_types:
      type: array
      items:
        type: string
      default: null  # null = all default entities
    confidence_threshold:
      type: number
      default: 0.5
      minimum: 0.0
      maximum: 1.0
  additionalProperties: false

output_schema:
  type: object
  required:
    - entities
    - redacted_text
  properties:
    entities:
      type: array
      description: Detected PII entities
      items:
        type: object
        properties:
          entity_type:
            type: string
          category:
            type: string
          start_offset:
            type: integer
          end_offset:
            type: integer
          start_time:
            type: number
          end_time:
            type: number
          confidence:
            type: number
          speaker:
            type: string
          redacted_value:
            type: string
          original_text:
            type: string
    redacted_text:
      type: string
      description: Text with PII replaced by placeholders
    entity_count_by_type:
      type: object
      description: Count of each entity type detected
    processing_time_ms:
      type: integer
      description: Processing time in milliseconds

hf_compat:
  pipeline_tag: dalston:pii-redaction
  library_name: presidio
  license: mit

hardware:
  min_vram_gb: 0
  supports_cpu: true
  min_ram_gb: 4

performance:
  rtf_gpu: 0.01
  rtf_cpu: 0.05
  warm_start_latency_ms: 100
