schema_version: "1.1"
id: whisperx-align
stage: align
name: WhisperX Alignment
version: 1.0.0
description: |
  Word-level timestamp alignment using WhisperX with wav2vec2-based
  forced alignment. Produces more accurate word boundaries than
  transcription-time estimates.

  Loads language-specific alignment models lazily on first use.
  Supports 100+ languages via wav2vec2 models from HuggingFace.

container:
  gpu: optional  # Recommended for performance; falls back to CPU
  memory: 4G
  model_cache: /models

capabilities:
  languages:
    - all  # Supports languages with wav2vec2 models
  max_audio_duration: 7200  # 2 hours
  streaming: false
  word_timestamps: true
  max_concurrency: 8

input:
  audio_formats:
    - wav
  sample_rate: 16000
  channels: 1

config_schema:
  type: object
  properties:
    return_char_alignments:
      type: boolean
      default: false
      description: Also return character-level alignments
  additionalProperties: false

output_schema:
  type: object
  required:
    - text
    - segments
    - language
    - word_timestamps
  properties:
    text:
      type: string
      description: Full transcript text (passed through from transcribe)
    segments:
      type: array
      description: Aligned segments with word-level timestamps
      items:
        type: object
        required:
          - start
          - end
          - text
        properties:
          start:
            type: number
            description: Segment start time in seconds
          end:
            type: number
            description: Segment end time in seconds
          text:
            type: string
            description: Segment text
          words:
            type: array
            description: Word-level timestamps
            items:
              type: object
              required:
                - word
                - start
                - end
              properties:
                word:
                  type: string
                  description: The word
                start:
                  type: number
                  description: Word start time in seconds
                end:
                  type: number
                  description: Word end time in seconds
                confidence:
                  type: number
                  description: Alignment confidence (0-1)
    language:
      type: string
      description: Language code (passed through from transcribe)
    word_timestamps:
      type: boolean
      description: Always true for this engine

hf_compat:
  pipeline_tag: automatic-speech-recognition
  library_name: whisperx
  license: bsd-4-clause

hardware:
  min_vram_gb: 2
  recommended_gpu:
    - t4
  supports_cpu: true
  min_ram_gb: 4

performance:
  rtf_gpu: 0.02
  rtf_cpu: 0.3
  warm_start_latency_ms: 200
